{"version":3,"file":"static/js/251.01140d62.chunk.js","mappings":"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","sources":["components/hoc/withAuthRedirect.tsx","webpack://vk-clone/./src/components/users/Users.module.scss?b897","components/users/User.tsx","components/users/UsersSearchForm.tsx","components/users/Users.tsx","utils/useOnScreen.ts"],"sourcesContent":["import React, {ComponentType} from 'react';\r\nimport {Navigate} from 'react-router-dom';\r\nimport {useAppSelector} from \"../../redux/store\";\r\n\r\nexport function WithAuthRedirect<T>(WrappedComponent: ComponentType<T>) {\r\n    function ComponentWithRedirect(props: T) {\r\n\r\n        const isLogin = useAppSelector(state => state.auth.isLogin)\r\n\r\n        if (!isLogin) return <Navigate to=\"/login\"/>\r\n\r\n        return (\r\n            <WrappedComponent {...props}/>\r\n        )\r\n    }\r\n\r\n    return ComponentWithRedirect\r\n}","// extracted by mini-css-extract-plugin\nexport default {\"content\":\"Users_content__5k+U+\",\"filter\":\"Users_filter__0w582\",\"body\":\"Users_body__G7hJX\",\"user\":\"Users_user__sxjid\",\"user__logo\":\"Users_user__logo__d7MZA\",\"user__body\":\"Users_user__body__4HLHO\",\"user__name\":\"Users_user__name__Bp0T1\",\"user__button\":\"Users_user__button__QBdpi\",\"user__button__isLoading\":\"Users_user__button__isLoading__zBsjs\"};","import React, {FC} from 'react';\r\nimport s from \"./Users.module.scss\";\r\nimport {useDispatch} from \"react-redux\";\r\nimport {fetchFollowing, fetchUnfollowing} from \"../../redux/reducers/users\";\r\nimport {NavLink} from \"react-router-dom\";\r\nimport {useAppSelector} from \"../../redux/store\";\r\n\r\ntype UserType = {\r\n    id: number\r\n    img: string | null\r\n    name: string\r\n    isFollowed: boolean\r\n}\r\n\r\nconst User: FC<UserType> = React.memo(({img, name, isFollowed, id}) => {\r\n\r\n    const dispatch = useDispatch()\r\n    const isLoading = useAppSelector(state => state.users.isFollowingInProgress)\r\n\r\n    // callbacks\r\n\r\n    const onClickFollowHandler = () => {\r\n        dispatch(fetchFollowing(id))\r\n    }\r\n\r\n    const onClickUnfollowHandler = () => {\r\n        dispatch(fetchUnfollowing(id))\r\n    }\r\n\r\n    return (\r\n        <div className={s.user}>\r\n            <NavLink to={`/profile/${id}`}>\r\n                <img className={s.user__logo}\r\n                     src={img ? img : \"/assets/img/avatar.jpg\"} alt={\"UserLogo\"}/>\r\n            </NavLink>\r\n            <div className={s.user__body}>\r\n                <NavLink to={`/profile/${id}`}><span className={s.user__name}>{name}</span></NavLink>\r\n                {isFollowed\r\n                    ? <span className={`${s.user__button} ${isLoading.id === id ? s.user__button__isLoading : \"\"}`}\r\n                            onClick={onClickUnfollowHandler}>Отписаться</span>\r\n                    : <span className={`${s.user__button} ${isLoading.id === id ? s.user__button__isLoading : \"\"}`}\r\n                            onClick={onClickFollowHandler}>Подписаться</span>\r\n                }\r\n            </div>\r\n        </div>\r\n    );\r\n})\r\n\r\nexport default User;","import React, {FC} from \"react\";\r\nimport {useForm} from \"react-hook-form\";\r\nimport {Nullable} from \"../../redux/store\";\r\nimport {FilterType} from \"../../redux/reducers/users\";\r\n\r\ntype UsersSearchFormType = {\r\n    filter: {\r\n        term: string,\r\n        friend: Nullable<boolean>\r\n    },\r\n    changeFilter: (filter: FilterType) => void\r\n}\r\n\r\ntype filterType = {\r\n    term: string\r\n    friend: string\r\n}\r\n\r\nexport const UsersSearchForm: FC<UsersSearchFormType> = React.memo(({filter, changeFilter}) => {\r\n\r\n    const {\r\n        register,\r\n        handleSubmit,\r\n    } = useForm<filterType>({\r\n        criteriaMode: \"all\",\r\n        defaultValues: {\r\n            term: filter.term,\r\n            friend: JSON.stringify(filter.friend)\r\n        }\r\n    })\r\n\r\n    const onSubmit = handleSubmit(data => {\r\n            const friend = data.friend === \"null\" ? null : data.friend === \"true\"\r\n            changeFilter({term: data.term, friend})\r\n        }\r\n    )\r\n\r\n    return (\r\n        <form onSubmit={onSubmit}>\r\n            <div style={{\r\n                backgroundColor: \"white\",\r\n                height: \"50px\",\r\n                display: \"flex\",\r\n                justifyContent: \"space-between\",\r\n                alignItems: \"center\",\r\n                padding: \"0 200px\"\r\n            }}>\r\n                <input\r\n                    placeholder={\"Введите имя пользователя\"}\r\n                    {...register(\"term\")}\r\n                />\r\n                <select {...register(\"friend\")}>\r\n                    <option value={\"null\"}>Все</option>\r\n                    <option value={\"true\"}>Подписки</option>\r\n                    <option value={\"false\"}>Другие</option>\r\n                </select>\r\n                <button className={\"button_find\"}>Найти</button>\r\n            </div>\r\n        </form>\r\n    );\r\n})","import React, {useRef, MutableRefObject, FC, useCallback, useEffect, useState} from 'react';\r\nimport s from \"./Users.module.scss\"\r\nimport {useAppSelector} from \"../../redux/store\";\r\nimport User from './User';\r\nimport {WithAuthRedirect} from \"../hoc/withAuthRedirect\";\r\nimport {compose} from 'redux';\r\nimport {clearUsers, fetchUsers, FilterType, setFilter, setPage} from \"../../redux/reducers/users\";\r\nimport {useDispatch} from \"react-redux\";\r\nimport {UsersSearchForm} from './UsersSearchForm';\r\nimport {useSearchParams} from 'react-router-dom';\r\nimport {useOnScreen} from '../../utils/useOnScreen';\r\n\r\nconst Users: FC = () => {\r\n\r\n    const observedElement = useRef() as MutableRefObject<HTMLInputElement>\r\n    const dispatch = useDispatch()\r\n    const page = useAppSelector(state => state.users.page)\r\n    const totalPage = useAppSelector(state => state.users.totalItems)\r\n    const users = useAppSelector(state => state.users.users)\r\n    const filter = useAppSelector(state => state.users.filter)\r\n    const [searchParams, setSearchParams] = useSearchParams()\r\n    const [isFetchedUsers, setIsFetchedUsers] = useState(false)\r\n    const isOnScreen = useOnScreen(observedElement);\r\n\r\n    useEffect(() => {\r\n        const parsed = Object.fromEntries(searchParams)\r\n\r\n        let actualFilter = filter\r\n\r\n        if (!!parsed.term) actualFilter = {...actualFilter, term: parsed.term as string}\r\n\r\n        switch (parsed.friend) {\r\n            case \"null\":\r\n                actualFilter = {...actualFilter, friend: null}\r\n                break;\r\n            case \"true\":\r\n                actualFilter = {...actualFilter, friend: true}\r\n                break;\r\n            case \"false\":\r\n                actualFilter = {...actualFilter, friend: false}\r\n                break;\r\n        }\r\n\r\n        dispatch(fetchUsers(1, actualFilter))\r\n    }, [dispatch])\r\n\r\n    useEffect(() => {\r\n\r\n        const query: any = {}\r\n\r\n        if (filter.term) query.term = filter.term\r\n        if (filter.friend !== null) query.friend = String(filter.friend)\r\n\r\n        setSearchParams({term: query.term ? query.term : \"\", friend: query.friend ? query.friend : null})\r\n\r\n    }, [filter])\r\n\r\n    useEffect(() => {\r\n        return () => {\r\n            dispatch(clearUsers())\r\n            dispatch(setFilter({term: \"\", friend: null}))\r\n            dispatch(setPage(1))\r\n        }\r\n    }, [])\r\n\r\n    useEffect(() => {\r\n        if (!isFetchedUsers) {\r\n            setIsFetchedUsers(true)\r\n            return\r\n        }\r\n        dispatch(fetchUsers(page, filter))\r\n    }, [filter, page])\r\n\r\n    useEffect(() => {\r\n        if ((page < (Math.ceil(totalPage / 10))) && isOnScreen) {\r\n            dispatch(setPage(page + 1))\r\n        }\r\n    }, [isOnScreen])\r\n\r\n    // callbacks\r\n\r\n    const changeFilterCallback = useCallback((filter: FilterType) => {\r\n        dispatch(setFilter(filter))\r\n        dispatch(setPage(1))\r\n        dispatch(clearUsers())\r\n    }, [dispatch, filter])\r\n\r\n    return (\r\n        <>\r\n            <UsersSearchForm changeFilter={changeFilterCallback} filter={filter}/>\r\n            <div className={s.content}>\r\n                <div className={s.body}>\r\n                    {users.map(el => {\r\n                            return <User key={el.id} img={el.photos?.small} name={el.name} isFollowed={el.followed}\r\n                                         id={el.id}/>\r\n                        }\r\n                    )}\r\n                    <div ref={observedElement}/>\r\n                </div>\r\n            </div>\r\n        </>\r\n    );\r\n};\r\n\r\nexport default compose(WithAuthRedirect)(Users)","import {useEffect, useState, useRef} from 'react';\r\n\r\nexport function useOnScreen(ref: any) {\r\n    const [isOnScreen, setIsOnScreen] = useState(false);\r\n    const observerRef = useRef(null);\r\n\r\n    useEffect(() => {\r\n\r\n        // @ts-ignore\r\n        observerRef.current = new IntersectionObserver(([entry]) =>\r\n            setIsOnScreen(entry.isIntersecting)\r\n        );\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        // @ts-ignore\r\n\r\n        observerRef.current.observe(ref.current);\r\n\r\n        return () => {\r\n            // @ts-ignore\r\n\r\n            observerRef.current.disconnect();\r\n        };\r\n    }, [ref]);\r\n\r\n    return isOnScreen;\r\n}"],"names":["WithAuthRedirect","WrappedComponent","props","useAppSelector","state","auth","isLogin","to","React","img","name","isFollowed","id","dispatch","useDispatch","isLoading","users","isFollowingInProgress","className","s","src","alt","onClick","fetchUnfollowing","fetchFollowing","UsersSearchForm","filter","changeFilter","useForm","criteriaMode","defaultValues","term","friend","JSON","stringify","register","onSubmit","handleSubmit","data","style","backgroundColor","height","display","justifyContent","alignItems","padding","placeholder","value","compose","observedElement","useRef","page","totalPage","totalItems","useSearchParams","searchParams","setSearchParams","useState","isFetchedUsers","setIsFetchedUsers","isOnScreen","ref","setIsOnScreen","observerRef","useEffect","current","IntersectionObserver","entry","isIntersecting","observe","disconnect","useOnScreen","parsed","Object","fromEntries","actualFilter","fetchUsers","query","String","clearUsers","setFilter","setPage","Math","ceil","changeFilterCallback","useCallback","map","el","photos","small","followed"],"sourceRoot":""}